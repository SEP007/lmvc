<script type="text/javascript">

    $(function() {

        $('#change').hide();
        $('#change-ca').hide();

        $.get('tasks', function(result) {
                for (i = 0; i < result.length; i++) {
                    $('#task-list').append(renderLine(result[i]));
                }
        });

    });

    function renderLine(task) {
        return '<li id="task'+task.id+'" data-id="'+task.id+'">'+task.description+' <span onclick="javascript:deleteTask('+task.id+')">DEL</span> <span onclick="javascript:updateTask('+task.id+')">EDT</span></li>';
    }

    function saveTask() {
        $.post('tasks', {description: $('#description').val(), priority: null}, function(result) {
            $('#task-list').append(renderLine(result));
            $('#description').val('');
        });
    }

    function deleteTask(id) {
        $.ajax({
            url: 'tasks/' + id,
            type: 'DELETE',
            success: function(result) {
                if (result.result == 'ok') {
                    $('#task'+id).remove();
                }
            }
        });
    }

    function updateTask(id) {
        $.get('tasks/' + id, function(result){
            $('#description').val(result.description);
            $('#description').data('id', result.id);
            $('#create').hide();
            $('#change').show();
            $('#change-ca').show();
        });
    }

    function cancelUpdateTask() {
        $('#description').val('');
        $('#create').show();
        $('#change').hide();
        $('#change-ca').hide();
    }

    function saveUpdateTask() {
        $.ajax({
            url: 'tasks/' + $('#description').data('id'),
            type: 'PUT',
            data: {description: $('#description').val(), done: 'no', deleted: 'no', priority: null},
            success: function(result) {
                $('#task'+result.id).html(result.description);
                $('#description').val('');
                $('#create').show();
                $('#change').hide();
                $('#change-ca').hide();
            }
        });
    }

</script>
<ul id="task-list"></ul>
<input type="text" id="description" name="description" value="">
<input id="create" name="create" type="button" value="OK" onclick="javascript:saveTask()">
<input id="change" name="change" type="button" value="OK" onclick="javascript:saveUpdateTask()">
<input id="change-ca" name="change-ca" type="button" value="Cancel" onclick="javascript:cancelUpdateTask()">
